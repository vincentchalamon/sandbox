{% extends 'SonataAdminBundle:CRUD:base_edit.html.twig' %}

{% block stylesheets %}
    {% spaceless %}
        {{ parent() }}
        <link type="text/css" rel="stylesheet" href="{{ asset('bundles/myquote/css/quote.css') }}" />
    {% endspaceless %}
{% endblock %}

{% block form %}
    {% spaceless %}
        {{ sonata_block_render_event('sonata.admin.edit.form.top', { 'admin': admin, 'object': object }) }}
        {% set url = admin.id(object) is not null ? 'edit' : 'create' %}
        {% if not admin.hasRoute(url)%}
            <div>
                {{ "form_not_available"|trans({}, "SonataAdminBundle") }}
            </div>
        {% else %}
            <div id="quote">
                <form class="form-horizontal"
                      action="{{ admin.generateUrl(url, {'id': admin.id(object), 'uniqid': admin.uniqid, 'subclass': app.request.get('subclass')}) }}" {{ form_enctype(form) }}
                      method="post"{% if not admin_pool.getOption('html5_validate') %} novalidate="novalidate"{% endif %}>
                    {% if form.vars.errors|length > 0 %}
                        <div class="sonata-ba-form-error">
                            {{ form_errors(form) }}
                        </div>
                    {% endif %}
                    <div class="row-fluid">
                        <div class="span6">
                            {{ ('gender.' ~ app.user.gender)|trans({}, 'SonataAdminBundle') }}
                            {{ app.user.firstname }} {{ app.user.lastname|upper }}<br />
                            {{ app.user.address }}<br />
                            {{ app.user.zipcode }} {{ app.user.city }}<br />
                            {{ app.user.phone }}<br />
                            <a href="mailto:{{ app.user.email }}">{{ app.user.email }}</a><br />
                            <a href="{{ url('homepage') }}">{{ url('homepage') }}</a><br />
                            <br />
                            SIRET : {{ app.user.formattedSiret }}<br />
                            Code APE : {{ app.user.ape }} Dispensé d’immatriculation<br />
                            <small>Dispensé d’immatriculation au registre du commerce<br />
                                   et des sociétés (RCS) et au répertoire des métiers (RM)</small>
                        </div>
                        <div class="span6" style="text-align: right;">
                            {{ form_widget(form.customer.id) }}
                            {{ form_widget(form.customer.name) }}<br />
                            {{ form_widget(form.customer.address) }}<br />
                            {{ form_widget(form.customer.zipcode) }}
                            {{ form_widget(form.customer.city) }}<br />
                            {{ form_widget(form.customer.email) }}
                        </div>
                    </div>
                    <div class="row-fluid">
                        <p style="text-align:right">Lille, le {{ 'now'|localizeddate('full', 'none') }}</p>
                        <h1>{{ object }}</h1>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th colspan="2">Prestation</th>
                                    <th>Prix Unit. HT</th>
                                    <th>Montant HT</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th colspan="3">
                                        <a class="btn" href="#" data-prototype="{{ form_widget(form.deliveries.vars.prototype)|e }}">
                                            <i class="icon-plus"></i>Ajouter
                                        </a>
                                        <span style="float:right">TOTAL HT</span>
                                    </th>
                                    <th><span>{{ object.amount|number_format(2, ',', ' ') }}</span> €</th>
                                </tr>
                            </tfoot>
                            <tbody>
                                {% for delivery in form.deliveries %}
                                    <tr>{{ form_widget(delivery) }}</tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <p style="text-align:right"><small>TVA non applicable, art.293B du CGI</small></p>
                        <br />
                        <table class="table table-bordered">
                            <tbody>
                                <tr>
                                    <td>
                                        <p><strong>Notes :</strong></p>
                                        {{ form_widget(form.notes) }}
                                    </td>
                                    <td>
                                        <p><strong>Modes de règlement :</strong></p>
                                        <p>Le règlement d'une première échéance de 50% du montant est demandée afin de
                                           démarrer le projet. Le client peut régler par virement bancaire ou chèque.</p>
                                        <p><strong>Date d'échéance :</strong></p>
                                        {{ form_widget(form.deadline) }}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    {{ form_widget(form._token) }}
                    {{ block('formactions') }}
                </form>
            </div>
        {% endif%}
        {{ sonata_block_render_event('sonata.admin.edit.form.bottom', { 'admin': admin, 'object': object }) }}
    {% endspaceless %}
{% endblock %}