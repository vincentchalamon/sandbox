<!DOCTYPE html>
<html>
    <head>
        <title>Vincent Chalamon</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link type="text/css" rel="stylesheet" media="screen" href="css/bootstrap.min.css" />
        <link type="text/css" rel="stylesheet" media="screen" href="js/snippet/jquery.snippet.css" />
        <link type="text/css" rel="stylesheet" media="screen" href="js/totop/ui.totop.css" />
        <link type="text/css" rel="stylesheet" media="screen" href="css/app.css" />
        <!--[if lt IE 9]>
        <script type="text/javascript" src="js/html5shiv.js"></script>
        <script type="text/javascript" src="js/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <header class="container">
            <a href="homepage.html" title="Vincent Chalamon" class="sitename col-md-5">
                Vincent Chalamon
                <span>Développeur multimédia</span>
            </a>
            <nav class="col-md-7 navbar navbar-default" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="homepage.html" title="Accueil">Accueil</a></li>
                        <li><a href="realisations.html" title="Réalisations">Réalisations</a></li>
                        <li><a href="cv.html" title="Curriculum Vitae">Curriculum Vitae</a></li>
                        <li><a href="#contact" title="Contact" data-toggle="modal">Contact</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <section id="article" class="container">
            <article class="col-md-8">
                <h1>Titre de mon article</h1>
                <section class="chapo">
                    <span>Posté le samedi 1 septembre 2012</span>
                    <ul class="tags">
                        <li><a href="recherche.html" title="PHP">PHP</a></li>
                        <li><a href="recherche.html" title="Symfony">Symfony</a></li>
                        <li><a href="recherche.html" title="Symfony 1.4">Symfony 1.4</a></li>
                        <li><a href="recherche.html" title="OVH">OVH</a></li>
                        <li><a href="recherche.html" title="Capistrano">Capistrano</a></li>
                        <li><a href="recherche.html" title="Git">Git</a></li>
                        <li><a href="recherche.html" title="Symfony 2">Symfony 2</a></li>
                    </ul>
                </section>
                <div class="contents"><p><strong>Pour réaliser ce tutoriel, vous aurez besoin de :</strong></p>
                    <ul>
                        <li><strong><a title="Capistrano" href="http://capistranorb.com" target="_blank">Capistrano</a></strong>
                        </li>
                        <li><strong>un serveur
                            <a title="mutualisé OVH Pro" href="http://www.ovh.com/fr/hebergement_mutualise/hebergement_web_mutualise_pro_100go_trafic_illimite.xml" target="_blank">mutualisé
                                                                                                                                                                                    OVH
                                                                                                                                                                                    Pro</a>
                                    ou supérieur</strong></li>
                        <li><strong>un
                            <a title="raton laveur" href="http://www.unjourunpoeme.fr/poeme/inventaire" target="_blank">raton
                                                                                                                        laveur</a></strong>
                        </li>
                        <li><strong><a title="Git" href="http://git-scm.com" target="_blank">Git</a></strong></li>
                        <li><strong>un projet <a title="Symfony" href="http://www.symfony-project.org" target="_blank">Symfony
                                                                                                                       1.4</a>
                                    ou <a title="Symfony" href="http://www.symfony.com" target="_blank">Symfony
                                                                                                        2</a></strong>
                        </li>
                        <li><strong>quelques connaissances en environnement Linux</strong></li>
                        <li><strong>et une bonne bière (toujours utile ;))</strong></li>
                    </ul>
                    <p>Pour ceux et celles d'entre vous qui ne connaissent pas encore,
                        <a title="Capistrano" href="http://capistranorb.com" target="_blank">Capistrano</a> est une
                       librairie Ruby permettant l'automatisation des déploiements de vos projets. Celle-ci utilise une
                       connexion ssh (ou ftp, selon la configuration choisie), et installe votre projet sur votre
                       serveur en un clin d'oeil. Plus besoin de transférer les fichiers à la main en ftp : lancez la
                       commande <em>cap deploy</em> et hop, votre projet est installé, migré et en ligne. Simple non ?
                        <img src="img/emoticons/face-smile.png" class="emoticonimg" alt=":)"></p>

                    <p class="info">Ce tutoriel n'a pas pour but de vous expliquer l'utilisation de Capistrano. Je vous
                                    laisse donc le soin d'étudier sa
                        <a title="documentation" href="http://capistranorb.com" target="_blank">documentation</a>.</p>
                    <ol>
                        <li><a title="Mise à niveau de Git" href="#mise-a-niveau-de-git">Mise à niveau de Git</a></li>
                        <li><a title="Création des dépôts" href="#creation-des-depots">Création des dépôts</a></li>
                        <li><a title="Préparation du projet" href="#preparation-du-projet">Préparation du projet</a>
                        </li>
                        <li><a title="Configuration de Capistrano" href="#configuration-de-capistrano">Configuration de
                                                                                                       Capistrano</a>
                        </li>
                        <li><a title="Code complet" href="#code-complet">Code complet</a></li>
                    </ol>
                    <p>Les serveurs OVH ne possèdent aucun accès à Internet, il est donc impossible d'accéder à des
                       ressources externes telles que
                        <a title="GitHub" href="https://github.com" target="_blank">GitHub</a> ou
                        <a title="Bitbucket" href="https://bitbucket.org" target="_blank">Bitbucket</a>. Nous allons
                       donc versionner le projet directement sur le serveur. Ainsi, Capistrano utilisera Git en interne
                       pour déployer le projet.</p>

                    <p>Pour cette installation, nous allons organiser le serveur comme suit :</p>
                    <ul>
                        <li><strong>~/opt/bin</strong> : binaires de git</li>
                        <li><strong>~/opt/git</strong> : dépôts git pour votre projet</li>
                        <li><strong>~/git</strong> : lien relatif vers les dépôts <strong>~/opt/git</strong></li>
                        <li><strong>~/master</strong> : répertoire de déploiement de la branche <em>master</em></li>
                        <li><strong>~/www</strong> : (obligatoire pour OVH) lien relatif vers le dernier déploiement de
                                                   la branche <em>master</em></li>
                    </ul>
                    <h2 id="mise-a-niveau-de-git">Mise à niveau de Git</h2>
                    <p>Par défaut, une version plus qu'obsolète de git est installée sur votre serveur (1.4.4).
                       Installons une version plus récente de Git sur le serveur.</p>

                    <p>Téléchargez les fichiers suivants, puis déposez les à la racine de serveur :</p>
                    <ul>
                        <li>
                            <a href="https://raw.github.com/git/git/master/contrib/completion/git-completion.bash" target="_blank">https://raw.github.com/git/git/master/contrib/completion/git-completion.bash</a>
                        </li>
                        <li><a href="http://git-core.googlecode.com/files/git-1.7.8.1.tar.gz" target="_blank">http://git-core.googlecode.com/files/git-1.7.8.1.tar.gz</a>
                        </li>
                    </ul>
                    <p>Connectez-vous ensuite en ssh à votre serveur pour en configurer l'architecture :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_1" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_1" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>mkdir <span class="sh_normal">-p</span>
                                    <span class="sh_symbol">~</span><span class="sh_normal">/opt/bin</span>
                                    <span class="sh_symbol">~</span><span class="sh_normal">/opt/git</span>
                                    <span class="sh_symbol">~</span><span class="sh_normal">/master</span></li>
                                <li>ln <span class="sh_normal">-s</span>
                                    <span class="sh_symbol">~</span><span class="sh_normal">/opt/git</span> git
                                </li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mkdir -p ~/opt/bin ~/opt/git ~/master
ln -s ~/opt/git git
</pre>
                        </div>
                    </div>
                    <p>Puis, éditez le fichier <em>.bash_profile</em> afin de prendre en compte la nouvelle
                       configuration :</p>
<pre class="log">alias php='php.ORIG.5_3 -C'
source $HOME/git-completion.bash
PATH=$HOME/opt/bin:$HOME/opt/bin/git-1.7.8.1:$PATH
</pre>
                    <p>Déplacez le fichier <em>git-1.7.8.1.tar.gz</em> vers le répertoire cible et commencez
                       l'installation :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_2" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_2" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>mv
                                    git<span class="sh_number">-1.7.8.1</span><span class="sh_symbol">.</span>tar<span class="sh_symbol">.</span>gz
                                    <span class="sh_symbol">~</span><span class="sh_normal">/opt/bin</span></li>
                                <li>cd <span class="sh_symbol">~</span><span class="sh_normal">/opt/bin</span></li>
                                <li>tar <span class="sh_normal">-zxvf</span>
                                    git<span class="sh_number">-1.7.8.1</span><span class="sh_symbol">.</span>tar<span class="sh_symbol">.</span>gz
                                </li>
                                <li>cd git<span class="sh_number">-1.7.8.1</span></li>
                                <li><span class="sh_symbol">.</span><span class="sh_normal">/configure</span>
                                    <span class="sh_normal">--prefix</span><span class="sh_symbol">=</span><span class="sh_variable">$HOME</span><span class="sh_normal">/opt</span>
                                    <span class="sh_normal">--without-tcltk</span></li>
                                <li>make</li>
                                <li>make install</li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mv git-1.7.8.1.tar.gz ~/opt/bin
cd ~/opt/bin
tar -zxvf git-1.7.8.1.tar.gz
cd git-1.7.8.1
./configure --prefix=$HOME/opt --without-tcltk
make
make install
</pre>
                        </div>
                    </div>
                    <p>Félicitations : Git est maintenant mis à niveau
                        <img src="img/emoticons/face-smile.png" class="emoticonimg" alt=":)"></p>

                    <h2 id="creation-des-depots">Création des dépôts</h2>
                    <p>Occupons-nous maintenant de versionner le projet. Pour cela, il faut créer le dépôt sur le
                       serveur :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_3" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_3" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>cd <span class="sh_symbol">~</span><span class="sh_normal">/git</span></li>
                                <li>mkdir monProjet<span class="sh_symbol">.</span>git</li>
                                <li>cd <span class="sh_symbol">!</span>$</li>
                                <li><span class="sh_symbol">~</span><span class="sh_normal">/opt/bin/git</span> init
                                    <span class="sh_normal">--bare</span></li>
                                <li>mv <span class="sh_normal">hooks/post-update</span><span class="sh_symbol">.</span>sample
                                    <span class="sh_normal">hooks/post-update</span></li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">cd ~/git
mkdir monProjet.git
cd !$
~/opt/bin/git init --bare
mv hooks/post-update.sample hooks/post-update
</pre>
                        </div>
                    </div>
                    <p>Le dépôt est maintenant disponible, vous pouvez initialiser le projet Git sur votre machine.</p>

                    <p class="info">Libre à vous de partir d'un nouveau projet, dans cet exemple je pars d'un projet
                                    existant.</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_4" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_4" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=4&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>cd <span class="sh_normal">/path/to/monProjet</span></li>
                                <li>git init <span class="sh_symbol">.</span></li>
                                <li>git remote add origin
                                    username@ftp<span class="sh_symbol">.</span><span class="sh_normal">mon-domaine</span><span class="sh_symbol">.</span>com<span class="sh_symbol">:</span><span class="sh_normal">git/monProjet</span><span class="sh_symbol">.</span>git
                                </li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">cd /path/to/monProjet
git init .
git remote add origin username@ftp.mon-domaine.com:git/monProjet.git
</pre>
                        </div>
                    </div>
                    <h2 id="preparation-du-projet">Préparation du projet</h2>
                    <p>Je ne sais pas vous, mais moi j'aime bien <em>nettoyer</em> mon projet, qu'il soit beau et propre
                        <img src="img/emoticons/face-smile.png" class="emoticonimg" alt=":)">.
                       Voici un exemple de fichier <em>.gitignore</em> ignorant les fichiers et dossiers superflus.</p>
<pre class="log">/config/databases.yml
/cache/*
/log/*
/data/sql/*
/data/*.lck
/lib/filter/doctrine/base/*
/lib/form/doctrine/base/*
/lib/model/doctrine/base/*
.channels/
.depdb
.depdblock
.filemap
.lock
.registry
.DS_Store
.Thumbs
/nbproject
/web/uploads
/web/sf*
</pre>
                    <p>Comme vous pouvez le voir, les fichiers de configuration Symfony sont ignorés. Cela permet d'en
                       avoir un par environnement : local, serveur de production, etc... Rapides comme vous êtes, vous
                       avez donc déjà créé les fichiers adéquats ?
                        <img src="img/emoticons/face-grin.png" class="emoticonimg" alt=":D"></p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_5" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_5" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=5&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>cp <span class="sh_normal">config/databases</span><span class="sh_symbol">.</span>yml
                                    <span class="sh_normal">config/databases</span><span class="sh_symbol">.</span>yml<span class="sh_symbol">.</span>prod
                                </li>
                                <li>cp <span class="sh_normal">config/databases</span><span class="sh_symbol">.</span>yml
                                    <span class="sh_normal">config/databases</span><span class="sh_symbol">.</span>yml<span class="sh_symbol">.</span>sample
                                </li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">cp config/databases.yml config/databases.yml.prod
cp config/databases.yml config/databases.yml.sample
</pre>
                        </div>
                    </div>
                    <p>Par défaut, OVH propose une configuration pour PHP 4 (hum, pas très à jour tout ça...
                        <img src="img/emoticons/face-plain.png" class="emoticonimg" alt=":|">).
                       Modifiez donc le fichier <em>.htaccess</em> comme suit :</p>
<pre class="log">SetEnv PHP_VER 5
SetEnv SESSION_USE_TRANS_SID 0
SetEnv REGISTER_GLOBALS 0
SetEnv MAGIC_QUOTES 0
</pre>
                    <p class="info">Vous utilisez PHP 5.3 ? Modifier le fichier <em>.htaccess</em> avec la ligne
                                    suivante :</p>
                    <pre class="log">SetEnv PHP_VER 5_3</pre>
                    <p class="info">Vous préférez PHP 5.4 ? Modifier le fichier <em>.htaccess</em> avec la ligne
                                    suivante :</p>
                    <pre class="log">SetEnv PHP_VER 5_4</pre>
                    <p class="info">Plus d'informations sur le
                        <a title="guide OVH" href="http://guide.ovh.com" target="_blank">guide OVH</a>.</p>

                    <p>Il ne nous reste plus qu'à envoyer le projet sur le serveur :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_6" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_6" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=6&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>git add <span class="sh_symbol">.</span></li>
                                <li>git commit <span class="sh_normal">-m</span> <span class="sh_string">"Initialisation du projet"</span>
                                </li>
                                <li>git push <span class="sh_normal">-u</span> master</li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">git add .
git commit -m "Initialisation du projet"
git push -u master
</pre>
                        </div>
                    </div>
                    <h2 id="configuration-de-capistrano">Configuration de Capistrano</h2>
                    <p>- C'est bien beau tout ça, on installe on installe, mais quand est-ce qu'on déploie ?<br> - Tout
                       vient à point à qui sait attendre !</p>

                    <p><em>Capifions</em> tout d'abord ce magnifique projet :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_7" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_7" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=7&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>capify <span class="sh_symbol">.</span></li>
                            </ol></pre>
                            <pre class="snippet-textonly sh_sourceCode" style="display:none;">capify .</pre>
                        </div>
                    </div>
                    <p class="info">Cette commande Capistrano crée différents fichiers dans votre projet. Le plus
                                    intéressant et essentiel au déploiement est <em>config/deploy.rb</em>.</p>

                    <p>Section après section, nous allons étudier ce fichier. La première section concerne la
                       configuration de votre serveur (accès, binaires, etc...) :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_12" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_12" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=12&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="ruby sh_ruby snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>set <span class="sh_symbol">:</span>user<span class="sh_symbol">,</span>
                                    <span class="sh_string">"USERNAME"</span> <span class="sh_comment"># Utilisateur de connexion ssh</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>password<span class="sh_symbol">,</span>
                                    <span class="sh_string">"PASSWORD"</span> <span class="sh_comment"># Mot de passe de connexion ssh</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>application<span class="sh_symbol">,</span>
                                    <span class="sh_string">"monProjet"</span> <span class="sh_comment"># Nom du projet Git</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>home<span class="sh_symbol">,</span>
                                    <span class="sh_string">"/path/to/root"</span> <span class="sh_comment"># Racine de votre serveur</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>domain<span class="sh_symbol">,</span>
                                    <span class="sh_string">"ftp.mon-domaine.com"</span> <span class="sh_comment"># Accès à votre serveur</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>php_bin<span class="sh_symbol">,</span>
                                    <span class="sh_string">"php.ORIG.5_3 -C"</span> <span class="sh_comment"># Binaire PHP 5.3. L'option -C désactive le chdir</span>
                                </li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">set :user,        "USERNAME" # Utilisateur de connexion ssh
set :password,    "PASSWORD" # Mot de passe de connexion ssh
set :application, "monProjet" # Nom du projet Git
set :home,        "/path/to/root" # Racine de votre serveur
set :domain,      "ftp.mon-domaine.com" # Accès à votre serveur
set :php_bin,     "php.ORIG.5_3 -C" # Binaire PHP 5.3. L'option -C désactive le chdir
</pre>
                        </div>
                    </div>
                    <p>Veillez à bien renseigner chaque paramètre. Seul l'option <em>php_bin</em> est déjà configurée à
                       la version de PHP 5.3 installée sur OVH.</p>

                    <p>La section suivante concerne la configuration de Git :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_13" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_13" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=13&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="ruby sh_ruby snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>set <span class="sh_symbol">:</span>git_bin<span class="sh_symbol">,</span>
                                    <span class="sh_string">"#{home}/opt/bin/git"</span> <span class="sh_comment"># Binaire Git</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>repository<span class="sh_symbol">,</span>
                                    <span class="sh_string">"--template=#{home}/opt/bin/git-1.7.8.1/templates #{home}/git/#{application}.git"</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>local_repository<span class="sh_symbol">,</span>
                                    <span class="sh_string">"#{user}@#{domain}:git/#{application}.git"</span></li>
                                <li>set <span class="sh_symbol">:</span>scm<span class="sh_symbol">,</span>
                                    <span class="sh_string">"git"</span> <span class="sh_comment"># Système de subversion utilisé</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>scm_verbose<span class="sh_symbol">,</span>
                                    <span class="sh_keyword">true</span></li>
                                <li>set
                                    <span class="sh_symbol">:</span>git_enable_submodules<span class="sh_symbol">,</span>
                                    <span class="sh_keyword">false</span> <span class="sh_comment"># Nous désactivons les submodules de Git</span>
                                </li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">set :git_bin,     "#{home}/opt/bin/git" # Binaire Git
set :repository,  "--template=#{home}/opt/bin/git-1.7.8.1/templates #{home}/git/#{application}.git"
set :local_repository, "#{user}@#{domain}:git/#{application}.git"
set :scm,         "git" # Système de subversion utilisé
set :scm_verbose, true
set :git_enable_submodules, false # Nous désactivons les submodules de Git
</pre>
                        </div>
                    </div>
                    <p>Dans cette section, nous configurons 2 options nécessaires : <em>repository</em> et <em>local_repository</em>.
                       La première concerne le chemin d'accès au dépôt du projet (ici directement depuis le serveur,
                       c'est-à-dire lui-même), la seconde détermine l'accès distant depuis votre machine (afin exécuter
                       la commande <em>git ls-remote</em>).</p>

                    <p>Configurons maintenant Symfony :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_14" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_14" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=14&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="ruby sh_ruby snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>set <span class="sh_symbol">:</span>sf_app<span class="sh_symbol">,</span>
                                    <span class="sh_string">"frontend"</span> <span class="sh_comment"># Nom de l'application Symfony</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>shared_children<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">%</span>w<span class="sh_symbol">(</span>cache log
                                    web<span class="sh_symbol">/</span>uploads<span class="sh_symbol">)</span>
                                    <span class="sh_comment"># Répertoires partagés</span></li>
                                <li>set <span class="sh_symbol">:</span>shared_files<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">%</span>w<span class="sh_symbol">(</span>config<span class="sh_regexp">/databases.yml web/</span><span class="sh_symbol">.</span>htaccess<span class="sh_symbol">)</span>
                                    <span class="sh_comment"># Fichiers de configuration</span></li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">set :sf_app,      "frontend" # Nom de l'application Symfony
set :shared_children, %w(cache log web/uploads) # Répertoires partagés
set :shared_files, %w(config/databases.yml web/.htaccess) # Fichiers de configuration
</pre>
                        </div>
                    </div>
                    <p class="info">Vous pouvez ajouter autant de répertoires que nécessaire à votre application dans
                                    l'option <em>shared_children</em>.</p>

                    <p>La configuration qui suit est le coeur même du déploiement Capistrano. Il se charge des fichiers
                       et répertoires partagés, et vous permet de choisir la branche (par défaut : <em>master</em> et/ou
                       l'environnement (par défaut : <em>prod</em>) à déployer :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_15" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_15" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=15&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="ruby sh_ruby snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>
                                    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'BRANCH'</span><span class="sh_symbol">]</span>
                                    <span class="sh_symbol">!=</span>
                                    <span class="sh_keyword">nil</span><span class="sh_symbol">)</span></li>
                                <li><span class="sh_keyword">if</span>
                                    Capistrano<span class="sh_symbol">::</span>CLI<span class="sh_symbol">.</span>ui<span class="sh_symbol">.</span>agree<span class="sh_symbol">(</span><span class="sh_string">"Voulez-vous vraiment deployer la branche "</span><span class="sh_symbol">+</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'BRANCH'</span><span class="sh_symbol">]+</span><span class="sh_string">" ? (y/n)"</span><span class="sh_symbol">)</span>
                                </li>
                                <li> set <span class="sh_symbol">:</span>branch<span class="sh_symbol">,</span>
                                     ENV<span class="sh_symbol">[</span><span class="sh_string">'BRANCH'</span><span class="sh_symbol">]</span>
                                </li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> exit <span class="sh_number">0</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> set <span class="sh_symbol">:</span>branch<span class="sh_symbol">,</span>
                                    <span class="sh_string">"master"</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li>
                                    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'ENV'</span><span class="sh_symbol">]</span>
                                    <span class="sh_symbol">!=</span>
                                    <span class="sh_keyword">nil</span><span class="sh_symbol">)</span></li>
                                <li><span class="sh_keyword">if</span>
                                    Capistrano<span class="sh_symbol">::</span>CLI<span class="sh_symbol">.</span>ui<span class="sh_symbol">.</span>agree<span class="sh_symbol">(</span><span class="sh_string">"Voulez-vous vraiment deployer l'environnement "</span><span class="sh_symbol">+</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'ENV'</span><span class="sh_symbol">]+</span><span class="sh_string">" ? (y/n)"</span><span class="sh_symbol">)</span>
                                </li>
                                <li> set <span class="sh_symbol">:</span>sf_env<span class="sh_symbol">,</span>
                                     ENV<span class="sh_symbol">[</span><span class="sh_string">'ENV'</span><span class="sh_symbol">]</span>
                                </li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> exit <span class="sh_number">0</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> set <span class="sh_symbol">:</span>sf_env<span class="sh_symbol">,</span>
                                    <span class="sh_string">"prod"</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li>set <span class="sh_symbol">:</span>deploy_to<span class="sh_symbol">,</span>
                                    <span class="sh_string">"#{home}/#{branch}"</span></li>
                                <li>server <span class="sh_string">"#{domain}"</span><span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>app<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>web<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>db<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>primary <span class="sh_symbol">=&gt;</span>
                                    <span class="sh_keyword">true</span></li>
                                <li>set <span class="sh_symbol">:</span>checkout<span class="sh_symbol">,</span>
                                    <span class="sh_string">"export"</span></li>
                                <li>set <span class="sh_symbol">:</span>deploy_via<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>checkout
                                </li>
                                <li>set <span class="sh_symbol">:</span>keep_releases<span class="sh_symbol">,</span>
                                    <span class="sh_number">3</span></li>
                                <li>
                                    ssh_options<span class="sh_symbol">[:</span>forward_agent<span class="sh_symbol">]</span>
                                    <span class="sh_symbol">=</span> <span class="sh_keyword">true</span></li>
                                <li>
                                    default_run_options<span class="sh_symbol">[:</span>pty<span class="sh_symbol">]</span>
                                    <span class="sh_symbol">=</span> <span class="sh_keyword">true</span></li>
                                <li>set <span class="sh_symbol">:</span>use_sudo<span class="sh_symbol">,</span>
                                    <span class="sh_keyword">false</span></li>
                                <li>
                                    default_environment<span class="sh_symbol">[</span><span class="sh_string">'PATH'</span><span class="sh_symbol">]=</span><span class="sh_string">"/bin:$HOME/opt/bin:/usr/local/bin:$HOME/opt/bin/git-1.7.8.1:$PATH"</span>
                                </li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li>namespace <span class="sh_symbol">:</span>deploy <span class="sh_keyword">do</span>
                                </li>
                                <li> desc <span class="sh_string">"Overwrite the restart task because symfony doesn't need it."</span>
                                </li>
                                <li> task <span class="sh_symbol">:</span>restart <span class="sh_keyword">do</span>
                                </li>
                                <li> deploy<span class="sh_symbol">.</span>cleanup</li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">"Symlink static directories and static files that need to remain between deployments."</span>
                                </li>
                                <li> task
                                    <span class="sh_symbol">:</span>finalize_update<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>except <span class="sh_symbol">=&gt;</span>
                                    <span class="sh_cbracket">{</span> <span class="sh_symbol">:</span>no_release
                                    <span class="sh_symbol">=&gt;</span> <span class="sh_keyword">true</span>
                                    <span class="sh_cbracket">}</span> <span class="sh_keyword">do</span></li>
                                <li><span class="sh_keyword">if</span> shared_children</li>
                                <li> shared_children<span class="sh_symbol">.</span>each
                                    <span class="sh_keyword">do</span>
                                    <span class="sh_symbol">|</span>link<span class="sh_symbol">|</span></li>
                                <li> run <span class="sh_string">"if [ ! -d #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ]; then mkdir -p #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ -d #{release_path}/#{link} ] || [ -f #{release_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">if</span> shared_files</li>
                                <li> shared_files<span class="sh_symbol">.</span>each <span class="sh_keyword">do</span>
                                    <span class="sh_symbol">|</span>link<span class="sh_symbol">|</span></li>
                                <li> link_dir <span class="sh_symbol">=</span> File<span class="sh_symbol">.</span>dirname<span class="sh_symbol">(</span><span class="sh_string">"#{shared_path}/#{link}"</span><span class="sh_symbol">)</span>
                                </li>
                                <li> run <span class="sh_string">"mkdir -p #{link_dir}"</span></li>
                                <li> run <span class="sh_string">"if [ -f #{release_path}/#{link}.#{sf_env} ]; then rm -rf #{release_path}/#{link} #{shared_path}/#{link} &amp;&amp; mv #{release_path}/#{link}.#{sf_env} #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ -f #{shared_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ -f #{release_path}/#{link} ]; then mv #{release_path}/#{link} #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{release_path}/#{link} ]; then touch #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">if(ENV['BRANCH'] != nil)
  if Capistrano::CLI.ui.agree("Voulez-vous vraiment deployer la branche "+ENV['BRANCH']+" ? (y/n)")
    set :branch,  ENV['BRANCH']
  else
    exit 0
  end
else
  set :branch,    "master"
end
if(ENV['ENV'] != nil)
  if Capistrano::CLI.ui.agree("Voulez-vous vraiment deployer l'environnement "+ENV['ENV']+" ? (y/n)")
    set :sf_env,  ENV['ENV']
  else
    exit 0
  end
else
  set :sf_env,    "prod"
end
set :deploy_to, "#{home}/#{branch}"
server            "#{domain}", :app, :web, :db, :primary =&gt; true
set :checkout,    "export"
set :deploy_via,  :checkout
set :keep_releases, 3
ssh_options[:forward_agent] = true
default_run_options[:pty] = true
set :use_sudo, false
default_environment['PATH']="/bin:$HOME/opt/bin:/usr/local/bin:$HOME/opt/bin/git-1.7.8.1:$PATH"

namespace :deploy do
  desc "Overwrite the restart task because symfony doesn't need it."
  task :restart do
    deploy.cleanup
  end

  desc "Symlink static directories and static files that need to remain between deployments."
  task :finalize_update, :except =&gt; { :no_release =&gt; true } do
    if shared_children
      shared_children.each do |link|
        run "if [ ! -d #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ]; then mkdir -p #{shared_path}/#{link}; fi"
        run "if [ -d #{release_path}/#{link} ] || [ -f #{release_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"
        run "ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"
      end
    end
    if shared_files
      shared_files.each do |link|
        link_dir = File.dirname("#{shared_path}/#{link}")
        run "mkdir -p #{link_dir}"
        run "if [ -f #{release_path}/#{link}.#{sf_env} ]; then rm -rf #{release_path}/#{link} #{shared_path}/#{link} &amp;&amp; mv #{release_path}/#{link}.#{sf_env} #{shared_path}/#{link}; fi"
        run "if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ -f #{shared_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"
        run "if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ -f #{release_path}/#{link} ]; then mv #{release_path}/#{link} #{shared_path}/#{link}; fi"
        run "if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{release_path}/#{link} ]; then touch #{shared_path}/#{link}; fi"
        run "ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"
      end
    end
  end
end
</pre>
                        </div>
                    </div>
                    <p class="info">Vous pouvez utiliser ces options grâce aux commandes suivantes :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_8" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_8" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=8&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>cap deploy</li>
                                <li>cap deploy <span class="sh_variable">BRANCH</span><span class="sh_symbol">=</span>master
                                </li>
                                <li>cap deploy <span class="sh_variable">BRANCH</span><span class="sh_symbol">=</span>master
                                    <span class="sh_variable">ENV</span><span class="sh_symbol">=</span>prod
                                </li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">cap deploy
cap deploy BRANCH=master
cap deploy BRANCH=master ENV=prod
</pre>
                        </div>
                    </div>
                    <p>Pour terminer, nous allons ajouter des commandes spéciales symfony à notre déploiement :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_16" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_16" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=16&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="ruby sh_ruby snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>namespace <span class="sh_symbol">(:</span>symfony<span class="sh_symbol">)</span>
                                    <span class="sh_keyword">do</span></li>
                                <li> desc <span class="sh_string">'Run the "doctrine migrations" task'</span></li>
                                <li> task <span class="sh_symbol">:</span>migrate <span class="sh_keyword">do</span>
                                </li>
                                <li> run <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:build --all-classes"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ -d #{release_path}/lib/migration/doctrine ] ; then cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:migrate; fi"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">'Run the "symfony cc" task'</span></li>
                                <li> task <span class="sh_symbol">:</span>cc <span class="sh_keyword">do</span></li>
                                <li> run
                                    <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} symfony cc"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">'Publish plugins assets'</span></li>
                                <li> task <span class="sh_symbol">:</span>publish_assets
                                    <span class="sh_keyword">do</span></li>
                                <li> run <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} symfony plugin:publish-assets"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">'Fix directories perms for OVH'</span></li>
                                <li> task <span class="sh_symbol">:</span>fix_perms <span class="sh_keyword">do</span>
                                </li>
                                <li> run <span class="sh_string">"chmod 705 #{home}/www"</span></li>
                                <li> run <span class="sh_string">"chmod -R 755 #{release_path}"</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li>after <span class="sh_string">"deploy:finalize_update"</span>
                                    <span class="sh_keyword">do</span></li>
                                <li> symfony<span class="sh_symbol">.</span>cc</li>
                                <li> symfony<span class="sh_symbol">.</span>migrate</li>
                                <li> symfony<span class="sh_symbol">.</span>publish_assets</li>
                                <li> symfony<span class="sh_symbol">.</span>cc</li>
                                <li> symfony<span class="sh_symbol">.</span>fix_perms</li>
                                <li><span class="sh_keyword">end</span></li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">namespace (:symfony) do
  desc 'Run the "doctrine migrations" task'
  task :migrate do
    run "cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:build --all-classes"
    run "if [ -d #{release_path}/lib/migration/doctrine ] ; then cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:migrate; fi"
  end

  desc 'Run the "symfony cc" task'
  task :cc do
    run "cd #{release_path} &amp;&amp; #{php_bin} symfony cc"
  end

  desc 'Publish plugins assets'
  task :publish_assets do
    run "cd #{release_path} &amp;&amp; #{php_bin} symfony plugin:publish-assets"
  end

  desc 'Fix directories perms for OVH'
  task :fix_perms do
    run "chmod 705 #{home}/www"
    run "chmod -R 755 #{release_path}"
  end
end

after "deploy:finalize_update" do
  symfony.cc
  symfony.migrate
  symfony.publish_assets
  symfony.cc
  symfony.fix_perms
end
</pre>
                        </div>
                    </div>
                    <p class="info">Chaque section <em>task...end</em> configure une commande à exécuter. Les commandes
                                    précédentes concernent celles de base à un projet Symfony. Ajoutez autant de
                                    commandes que nécessaire à votre projet.</p>

                    <p>La dernière commande <em>fix_perms</em> va configurer les permissions de vos répertoires sur
                       votre serveur mutualisé OVH Pro. En effet, OVH refuse de fonctionner si le répertoire principal
                       de votre projet n'est pas en 705, et les autres répertoires en 755 :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_9" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_9" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=9&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>chmod <span class="sh_number">705</span>
                                    <span class="sh_normal">/path/to/root/www</span></li>
                                <li>chmod <span class="sh_normal">-R</span> <span class="sh_number">755</span>
                                    <span class="sh_normal">/path/to/root/master/current</span></li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">chmod 705 /path/to/root/www
chmod -R 755 /path/to/root/master/current
</pre>
                        </div>
                    </div>
                    <p class="info">Vous utilisez Symfony 2 ? Remplacez la section <em>namespace (:symfony)...</em> par
                                    le code suivant :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_17" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_17" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=17&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="ruby sh_ruby snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>namespace <span class="sh_symbol">(:</span>symfony<span class="sh_symbol">)</span>
                                    <span class="sh_keyword">do</span></li>
                                <li> desc <span class="sh_string">'Run the "doctrine migrations" task'</span></li>
                                <li> task <span class="sh_symbol">:</span>migrate <span class="sh_keyword">do</span>
                                </li>
                                <li> run <span class="sh_string">"if [ -d #{release_path}/vendor/doctrine/doctrine-migrations-bundle ]; then cd #{release_path} &amp;&amp; #{php_bin} app/console doctrine:migrations:migrate; fi"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">'Run the "symfony cc" task'</span></li>
                                <li> task <span class="sh_symbol">:</span>cc <span class="sh_keyword">do</span></li>
                                <li> run <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} app/console cache:clear"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> task <span class="sh_symbol">:</span>publish_assets
                                    <span class="sh_keyword">do</span></li>
                                <li> run <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} app/console assets:install web --symlink"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> task <span class="sh_symbol">:</span>fix_perms <span class="sh_keyword">do</span>
                                </li>
                                <li> run <span class="sh_string">"chmod 705 #{home}/www"</span></li>
                                <li> run <span class="sh_string">"chmod -R 755 #{release_path}"</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">namespace (:symfony) do
  desc 'Run the "doctrine migrations" task'
  task :migrate do
    run "if [ -d #{release_path}/vendor/doctrine/doctrine-migrations-bundle ]; then cd #{release_path} &amp;&amp; #{php_bin} app/console doctrine:migrations:migrate; fi"
  end

  desc 'Run the "symfony cc" task'
  task :cc do
    run "cd #{release_path} &amp;&amp; #{php_bin} app/console cache:clear"
  end

  task :publish_assets do
    run "cd #{release_path} &amp;&amp; #{php_bin} app/console assets:install web --symlink"
  end

  task :fix_perms do
    run "chmod 705 #{home}/www"
    run "chmod -R 755 #{release_path}"
  end
end
</pre>
                        </div>
                    </div>
                    <p>La configuration du déploiement est maintenant terminée (enfin
                        <img src="img/emoticons/face-happy.png" class="emoticonimg" alt=":p">).
                       Voici la commande à utiliser pour déployer votre projet :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_10" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_10" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=10&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>cap deploy</li>
                            </ol></pre>
                            <pre class="snippet-textonly sh_sourceCode" style="display:none;">cap deploy</pre>
                        </div>
                    </div>
                    <p>Si vous avez des branches supplémentaires et/ou des environnements complémentaires (serveur de
                       test, de preprod, etc...), préférez la commande suivante :</p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_11" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_11" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=11&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="sh sh_sh snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li>cap deploy <span class="sh_variable">ENV</span><span class="sh_symbol">=</span>prod
                                    <span class="sh_variable">BRANCH</span><span class="sh_symbol">=</span>master
                                </li>
                            </ol></pre>
                            <pre class="snippet-textonly sh_sourceCode" style="display:none;">cap deploy ENV=prod BRANCH=master</pre>
                        </div>
                    </div>
                    <h2 id="code-complet">Code complet</h2>
                    <p>Voici le code complet du fichier <em>config/deploy.rb</em>. Cette configuration concerne un
                       projet Symfony 1.4 sous PHP 5.2.</p>

                    <p><strong>N'oubliez pas de consulter la
                        <a title="procédure d'installation" href="#mise-a-niveau-de-git">procédure d'installation</a> !</strong>
                    </p>

                    <div class="snippet-container" style="undefined;">
                        <div class="sh_golden snippet-wrap">
                            <div class="snippet-menu sh_sourceCode" style="display: none;">
                                <pre><a class="snippet-copy sh_url" href="#">copy</a><a class="snippet-text sh_url" href="#">text</a><a class="snippet-window sh_url" href="#">pop-up</a></pre>
                                <div class="snippet-clipboard" style="position: absolute; left: 0px; top: 3px; width: 42px; height: 14px; z-index: 99;">
                                    <embed id="ZeroClipboardMovie_18" src="/bundles/vincentblog/js/snippet/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="42" height="14" name="ZeroClipboardMovie_18" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=18&amp;width=42&amp;height=14" wmode="transparent">
                                </div>
                            </div>
                            <pre class="ruby sh_ruby snippet-formatted sh_sourceCode"><ol class="snippet-num">
                                <li><span class="sh_symbol">\</span><span class="sh_comment"># Serveur</span></li>
                                <li>set <span class="sh_symbol">:</span>user<span class="sh_symbol">,</span>
                                    <span class="sh_string">"USERNAME"</span></li>
                                <li>set <span class="sh_symbol">:</span>password<span class="sh_symbol">,</span>
                                    <span class="sh_string">"PASSWORD"</span></li>
                                <li>set <span class="sh_symbol">:</span>application<span class="sh_symbol">,</span>
                                    <span class="sh_string">"monProjet"</span></li>
                                <li>set <span class="sh_symbol">:</span>home<span class="sh_symbol">,</span>
                                    <span class="sh_string">"/path/to/root"</span></li>
                                <li>set <span class="sh_symbol">:</span>domain<span class="sh_symbol">,</span>
                                    <span class="sh_string">"ftp.mon-domaine.com"</span></li>
                                <li>set <span class="sh_symbol">:</span>php_bin<span class="sh_symbol">,</span>
                                    <span class="sh_string">"php.ORIG.5_3 -C"</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li><span class="sh_symbol">\</span><span class="sh_comment"># Git</span></li>
                                <li>set <span class="sh_symbol">:</span>git_bin<span class="sh_symbol">,</span>
                                    <span class="sh_string">"#{home}/opt/bin/git"</span></li>
                                <li>set <span class="sh_symbol">:</span>repository<span class="sh_symbol">,</span>
                                    <span class="sh_string">"--template=#{home}/opt/bin/git-1.7.8.1/templates #{home}/git/#{application}.git"</span>
                                </li>
                                <li>set <span class="sh_symbol">:</span>local_repository<span class="sh_symbol">,</span>
                                    <span class="sh_string">"#{user}@#{domain}:git/#{application}.git"</span></li>
                                <li>set <span class="sh_symbol">:</span>scm<span class="sh_symbol">,</span>
                                    <span class="sh_string">"git"</span></li>
                                <li>set <span class="sh_symbol">:</span>scm_verbose<span class="sh_symbol">,</span>
                                    <span class="sh_keyword">true</span></li>
                                <li>set
                                    <span class="sh_symbol">:</span>git_enable_submodules<span class="sh_symbol">,</span>
                                    <span class="sh_keyword">false</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li><span class="sh_symbol">\</span><span class="sh_comment"># Symfony</span></li>
                                <li>set <span class="sh_symbol">:</span>sf_app<span class="sh_symbol">,</span>
                                    <span class="sh_string">"frontend"</span></li>
                                <li>set <span class="sh_symbol">:</span>shared_children<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">%</span>w<span class="sh_symbol">(</span>cache log
                                    web<span class="sh_symbol">/</span>uploads<span class="sh_symbol">)</span></li>
                                <li>set <span class="sh_symbol">:</span>shared_files<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">%</span>w<span class="sh_symbol">(</span>config<span class="sh_regexp">/databases.yml web/</span><span class="sh_symbol">.</span>htaccess<span class="sh_symbol">)</span>
                                </li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li><span class="sh_symbol">\</span><span class="sh_comment"># Déploiement</span></li>
                                <li>
                                    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'BRANCH'</span><span class="sh_symbol">]</span>
                                    <span class="sh_symbol">!=</span>
                                    <span class="sh_keyword">nil</span><span class="sh_symbol">)</span></li>
                                <li><span class="sh_keyword">if</span>
                                    Capistrano<span class="sh_symbol">::</span>CLI<span class="sh_symbol">.</span>ui<span class="sh_symbol">.</span>agree<span class="sh_symbol">(</span><span class="sh_string">"Voulez-vous vraiment deployer la branche "</span><span class="sh_symbol">+</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'BRANCH'</span><span class="sh_symbol">]+</span><span class="sh_string">" ? (y/n)"</span><span class="sh_symbol">)</span>
                                </li>
                                <li> set <span class="sh_symbol">:</span>branch<span class="sh_symbol">,</span>
                                     ENV<span class="sh_symbol">[</span><span class="sh_string">'BRANCH'</span><span class="sh_symbol">]</span>
                                </li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> exit <span class="sh_number">0</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> set <span class="sh_symbol">:</span>branch<span class="sh_symbol">,</span>
                                    <span class="sh_string">"master"</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li>
                                    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'ENV'</span><span class="sh_symbol">]</span>
                                    <span class="sh_symbol">!=</span>
                                    <span class="sh_keyword">nil</span><span class="sh_symbol">)</span></li>
                                <li><span class="sh_keyword">if</span>
                                    Capistrano<span class="sh_symbol">::</span>CLI<span class="sh_symbol">.</span>ui<span class="sh_symbol">.</span>agree<span class="sh_symbol">(</span><span class="sh_string">"Voulez-vous vraiment deployer l'environnement "</span><span class="sh_symbol">+</span>ENV<span class="sh_symbol">[</span><span class="sh_string">'ENV'</span><span class="sh_symbol">]+</span><span class="sh_string">" ? (y/n)"</span><span class="sh_symbol">)</span>
                                </li>
                                <li> set <span class="sh_symbol">:</span>sf_env<span class="sh_symbol">,</span>
                                     ENV<span class="sh_symbol">[</span><span class="sh_string">'ENV'</span><span class="sh_symbol">]</span>
                                </li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> exit <span class="sh_number">0</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">else</span></li>
                                <li> set <span class="sh_symbol">:</span>sf_env<span class="sh_symbol">,</span>
                                    <span class="sh_string">"prod"</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li>set <span class="sh_symbol">:</span>deploy_to<span class="sh_symbol">,</span>
                                    <span class="sh_string">"#{home}/#{branch}"</span></li>
                                <li>server <span class="sh_string">"#{domain}"</span><span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>app<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>web<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>db<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>primary <span class="sh_symbol">=&gt;</span>
                                    <span class="sh_keyword">true</span></li>
                                <li>set <span class="sh_symbol">:</span>checkout<span class="sh_symbol">,</span>
                                    <span class="sh_string">"export"</span></li>
                                <li>set <span class="sh_symbol">:</span>deploy_via<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>checkout
                                </li>
                                <li>set <span class="sh_symbol">:</span>keep_releases<span class="sh_symbol">,</span>
                                    <span class="sh_number">3</span></li>
                                <li>
                                    ssh_options<span class="sh_symbol">[:</span>forward_agent<span class="sh_symbol">]</span>
                                    <span class="sh_symbol">=</span> <span class="sh_keyword">true</span></li>
                                <li>
                                    default_run_options<span class="sh_symbol">[:</span>pty<span class="sh_symbol">]</span>
                                    <span class="sh_symbol">=</span> <span class="sh_keyword">true</span></li>
                                <li>set <span class="sh_symbol">:</span>use_sudo<span class="sh_symbol">,</span>
                                    <span class="sh_keyword">false</span></li>
                                <li>
                                    default_environment<span class="sh_symbol">[</span><span class="sh_string">'PATH'</span><span class="sh_symbol">]=</span><span class="sh_string">"/bin:$HOME/opt/bin:/usr/local/bin:$HOME/opt/bin/git-1.7.8.1:$PATH"</span>
                                </li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li>namespace <span class="sh_symbol">:</span>deploy <span class="sh_keyword">do</span>
                                </li>
                                <li> desc <span class="sh_string">"Overwrite the restart task because symfony doesn't need it."</span>
                                </li>
                                <li> task <span class="sh_symbol">:</span>restart <span class="sh_keyword">do</span>
                                </li>
                                <li> deploy<span class="sh_symbol">.</span>cleanup</li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">"Symlink static directories and static files that need to remain between deployments."</span>
                                </li>
                                <li> task
                                    <span class="sh_symbol">:</span>finalize_update<span class="sh_symbol">,</span>
                                    <span class="sh_symbol">:</span>except <span class="sh_symbol">=&gt;</span>
                                    <span class="sh_cbracket">{</span> <span class="sh_symbol">:</span>no_release
                                    <span class="sh_symbol">=&gt;</span> <span class="sh_keyword">true</span>
                                    <span class="sh_cbracket">}</span> <span class="sh_keyword">do</span></li>
                                <li><span class="sh_keyword">if</span> shared_children</li>
                                <li> shared_children<span class="sh_symbol">.</span>each
                                    <span class="sh_keyword">do</span>
                                    <span class="sh_symbol">|</span>link<span class="sh_symbol">|</span></li>
                                <li> run <span class="sh_string">"if [ ! -d #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ]; then mkdir -p #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ -d #{release_path}/#{link} ] || [ -f #{release_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">if</span> shared_files</li>
                                <li> shared_files<span class="sh_symbol">.</span>each <span class="sh_keyword">do</span>
                                    <span class="sh_symbol">|</span>link<span class="sh_symbol">|</span></li>
                                <li> link_dir <span class="sh_symbol">=</span> File<span class="sh_symbol">.</span>dirname<span class="sh_symbol">(</span><span class="sh_string">"#{shared_path}/#{link}"</span><span class="sh_symbol">)</span>
                                </li>
                                <li> run <span class="sh_string">"mkdir -p #{link_dir}"</span></li>
                                <li> run <span class="sh_string">"if [ -f #{release_path}/#{link}.#{sf_env} ]; then rm -rf #{release_path}/#{link} #{shared_path}/#{link} &amp;&amp; mv #{release_path}/#{link}.#{sf_env} #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ -f #{shared_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ -f #{release_path}/#{link} ]; then mv #{release_path}/#{link} #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{release_path}/#{link} ]; then touch #{shared_path}/#{link}; fi"</span>
                                </li>
                                <li> run <span class="sh_string">"ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li>
                                    <span class="sh_symbol">\</span><span class="sh_comment"># Commandes complémentaires</span>
                                </li>
                                <li>namespace <span class="sh_symbol">(:</span>symfony<span class="sh_symbol">)</span>
                                    <span class="sh_keyword">do</span></li>
                                <li> desc <span class="sh_string">'Run the "doctrine migrations" task'</span></li>
                                <li> task <span class="sh_symbol">:</span>migrate <span class="sh_keyword">do</span>
                                </li>
                                <li> run <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:build --all-classes"</span>
                                </li>
                                <li> run <span class="sh_string">"if [ -d #{release_path}/lib/migration/doctrine ] ; then cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:migrate; fi"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">'Run the "symfony cc" task'</span></li>
                                <li> task <span class="sh_symbol">:</span>cc <span class="sh_keyword">do</span></li>
                                <li> run <span class="sh_string">"rm -rf #{release_path}/cache/*"</span></li>
                                <li> run
                                    <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} symfony cc"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">'Publish plugins assets'</span></li>
                                <li> task <span class="sh_symbol">:</span>publish_assets
                                    <span class="sh_keyword">do</span></li>
                                <li> run <span class="sh_string">"cd #{release_path} &amp;&amp; #{php_bin} symfony plugin:publish-assets"</span>
                                </li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li> desc <span class="sh_string">'Fix directories perms for OVH'</span></li>
                                <li> task <span class="sh_symbol">:</span>fix_perms <span class="sh_keyword">do</span>
                                </li>
                                <li> run <span class="sh_string">"chmod 705 #{home}/www"</span></li>
                                <li> run <span class="sh_string">"chmod -R 755 #{release_path}"</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span class="sh_keyword">end</span></li>
                                <li><span style="display:none;">&nbsp;</span></li>
                                <li>after <span class="sh_string">"deploy:finalize_update"</span>
                                    <span class="sh_keyword">do</span></li>
                                <li> symfony<span class="sh_symbol">.</span>cc</li>
                                <li> symfony<span class="sh_symbol">.</span>migrate</li>
                                <li> symfony<span class="sh_symbol">.</span>publish_assets</li>
                                <li> symfony<span class="sh_symbol">.</span>cc</li>
                                <li> symfony<span class="sh_symbol">.</span>fix_perms</li>
                                <li><span class="sh_keyword">end</span></li>
                            </ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">\# Serveur
set :user,        "USERNAME"
set :password,    "PASSWORD"
set :application, "monProjet"
set :home,        "/path/to/root"
set :domain,      "ftp.mon-domaine.com"
set :php_bin,     "php.ORIG.5_3 -C"

\# Git
set :git_bin,     "#{home}/opt/bin/git"
set :repository,  "--template=#{home}/opt/bin/git-1.7.8.1/templates #{home}/git/#{application}.git"
set :local_repository, "#{user}@#{domain}:git/#{application}.git"
set :scm,         "git"
set :scm_verbose, true
set :git_enable_submodules, false

\# Symfony
set :sf_app,      "frontend"
set :shared_children, %w(cache log web/uploads)
set :shared_files, %w(config/databases.yml web/.htaccess)

\# Déploiement
if(ENV['BRANCH'] != nil)
  if Capistrano::CLI.ui.agree("Voulez-vous vraiment deployer la branche "+ENV['BRANCH']+" ? (y/n)")
    set :branch,  ENV['BRANCH']
  else
    exit 0
  end
else
  set :branch,    "master"
end
if(ENV['ENV'] != nil)
  if Capistrano::CLI.ui.agree("Voulez-vous vraiment deployer l'environnement "+ENV['ENV']+" ? (y/n)")
    set :sf_env,  ENV['ENV']
  else
    exit 0
  end
else
  set :sf_env,    "prod"
end
set :deploy_to, "#{home}/#{branch}"
server            "#{domain}", :app, :web, :db, :primary =&gt; true
set :checkout,    "export"
set :deploy_via,  :checkout
set :keep_releases, 3
ssh_options[:forward_agent] = true
default_run_options[:pty] = true
set :use_sudo, false
default_environment['PATH']="/bin:$HOME/opt/bin:/usr/local/bin:$HOME/opt/bin/git-1.7.8.1:$PATH"

namespace :deploy do
  desc "Overwrite the restart task because symfony doesn't need it."
  task :restart do
    deploy.cleanup
  end

  desc "Symlink static directories and static files that need to remain between deployments."
  task :finalize_update, :except =&gt; { :no_release =&gt; true } do
    if shared_children
      shared_children.each do |link|
        run "if [ ! -d #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ]; then mkdir -p #{shared_path}/#{link}; fi"
        run "if [ -d #{release_path}/#{link} ] || [ -f #{release_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"
        run "ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"
      end
    end
    if shared_files
      shared_files.each do |link|
        link_dir = File.dirname("#{shared_path}/#{link}")
        run "mkdir -p #{link_dir}"
        run "if [ -f #{release_path}/#{link}.#{sf_env} ]; then rm -rf #{release_path}/#{link} #{shared_path}/#{link} &amp;&amp; mv #{release_path}/#{link}.#{sf_env} #{shared_path}/#{link}; fi"
        run "if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ -f #{shared_path}/#{link} ]; then rm -rf #{release_path}/#{link}; fi"
        run "if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ -f #{release_path}/#{link} ]; then mv #{release_path}/#{link} #{shared_path}/#{link}; fi"
        run "if [ ! -f #{release_path}/#{link}.#{sf_env} ] &amp;&amp; [ ! -f #{shared_path}/#{link} ] &amp;&amp; [ ! -f #{release_path}/#{link} ]; then touch #{shared_path}/#{link}; fi"
        run "ln -nfs #{shared_path}/#{link} #{release_path}/#{link}"
      end
    end
  end

\# Commandes complémentaires
namespace (:symfony) do
  desc 'Run the "doctrine migrations" task'
  task :migrate do
    run "cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:build --all-classes"
    run "if [ -d #{release_path}/lib/migration/doctrine ] ; then cd #{release_path} &amp;&amp; #{php_bin} symfony doctrine:migrate; fi"
  end

  desc 'Run the "symfony cc" task'
  task :cc do
    run "rm -rf #{release_path}/cache/*"
    run "cd #{release_path} &amp;&amp; #{php_bin} symfony cc"
  end

  desc 'Publish plugins assets'
  task :publish_assets do
    run "cd #{release_path} &amp;&amp; #{php_bin} symfony plugin:publish-assets"
  end

  desc 'Fix directories perms for OVH'
  task :fix_perms do
    run "chmod 705 #{home}/www"
    run "chmod -R 755 #{release_path}"
  end
end

after "deploy:finalize_update" do
  symfony.cc
  symfony.migrate
  symfony.publish_assets
  symfony.cc
  symfony.fix_perms
end
</pre>
                        </div>
                    </div>
                </div>
                <div class="share">
                    <h3>Partagez cet article sur les réseaux sociaux !</h3>
                    <ul>
                        <li>
                            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Socialite.js" data-url="http://socialitejs.com" data-count="vertical" rel="nofollow" target="_blank">Partager sur Twitter</a>
                        </li>
                        <li>
                            <a href="https://plus.google.com/share?url=http://socialitejs.com" class="socialite googleplus-one" data-size="tall" data-href="http://socialitejs.com" rel="nofollow" target="_blank">Partager sur Google+</a>
                        </li>
                        <li>
                            <a href="http://www.facebook.com/sharer.php?u=http://www.socialitejs.com&amp;t=Socialite.js" class="socialite facebook-like" data-href="http://socialitejs.com" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank">Partager sur Facebook</a>
                        </li>
                        <li>
                            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://socialitejs.com&amp;title=Socialite.js" class="socialite linkedin-share" data-url="http://socialitejs.com" data-counter="top" rel="nofollow" target="_blank">Partager sur LinkedIn</a>
                        </li>
                        <li>
                            <div class="viadeo-share" data-display="btnlight" data-count="top" data-language="fr" data-partner-id="EOdubjbyEgewhdgdIzwvOeqDOc"></div>
                        </li>
                    </ul>
                </div>
            </article>

            <aside class="col-md-4">
                <form role="search">
                    <div class="input-group">
                        <input class="form-control" type="search" name="query" title="Rechercher" alt="Rechercher" placeholder="Saisissez votre recherche..." />

                        <div class="input-group-btn">
                            <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i>
                            </button>
                        </div>
                    </div>
                </form>
                <h2>Du même sujet</h2>
                <ul>
                    <li><a href="article.html" title="Autre article">Autre article</a></li>
                    <li><a href="article.html" title="Autre article">Autre article</a></li>
                    <li><a href="article.html" title="Autre article">Autre article</a></li>
                    <li><a href="article.html" title="Autre article">Autre article</a></li>
                </ul>
                <h2>Suivez-moi</h2>
                <ul class="follow">
                    <li><a href="" title="LinkedIn"><img src="uploads/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a></li>
                    <li><a href="" title="Viadeo"><img src="uploads/viadeo.png" alt="Viadeo" title="Viadeo" /></a></li>
                    <li><a href="" title="Google+"><img src="uploads/google.png" alt="Google+" title="Google+" /></a></li>
                    <li><a href="" title="Github"><img src="uploads/github.png" alt="Github" title="Github" /></a></li>
                    <li><a href="" title="RSS"><img src="uploads/rss.png" alt="RSS" title="RSS" /></a></li>
                    <li><a href="" title="twitter"><img src="uploads/twitter.png" alt="twitter" title="twitter" /></a></li>
                </ul>
                <h2>A propos</h2>
                <ul>
                    <li><a href="#contact" title="Formulaire de contact" data-toggle="modal">Formulaire de contact</a>
                    </li>
                    <li><a href="mailto:contact[at]vincent-chalamon.fr" title="contact[at]vincent-chalamon.fr">contact[at]vincent-chalamon.fr</a>
                    </li>
                    <li><a href="cv.html" title="Consultez mon CV">Consultez mon CV</a></li>
                    <li><a href="" title="Ylyad">Ylyad</a></li>
                </ul>
            </aside>
        </section>

        <footer>
            <p>Copyright &copy; 2013 Vincent Chalamon • Tous droits réservés</p>
            <p>Graphisme : <a href="" title="Oxymore Création">Oxymore Création</a></p>
        </footer>

        <div class="fork">
            <a href="https://github.com/vincentchalamon" title="Fork me on GitHub !" target="_blank">Fork me on GitHub !</a>
        </div>

        <div class="modal fade" id="contact" tabindex="-1" role="dialog" aria-labelledby="Contact" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h2 class="modal-title"><span class="glyphicon glyphicon-envelope"></span>Contact</h2>
                    </div>
                    <form role="contact">
                        <div class="modal-body">
                            <label for="name">Votre nom</label>

                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <input class="form-control" type="text" name="name" id="name" title="Votre nom" alt="Votre nom" placeholder="Votre nom" required data-validation-required-message="Veuillez saisir votre nom" />
                                <span class="input-validation"></span>
                            </div>

                            <label for="email">Votre email</label>

                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-envelope"></span></span>
                                <input class="form-control" type="email" name="email" id="email" title="Votre email" alt="Votre email" placeholder="Votre email" required data-validation-required-message="Veuillez saisir votre email" data-validation-invalid-message="Veuillez saisir une adresse email valide" />
                                <span class="input-validation"></span>
                            </div>

                            <label for="subject">Objet du message</label>

                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-info-sign"></span></span>
                                <input class="form-control" type="text" name="subject" id="subject" title="Objet du message" alt="Objet du message" placeholder="Objet du message" required data-validation-required-message="Veuillez saisir un objet pour le message" />
                                <span class="input-validation"></span>
                            </div>

                            <label for="message">Votre message</label>

                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-pencil"></span></span>
                                <textarea class="form-control" name="message" id="message" title="Votre message" placeholder="Votre message" required data-validation-required-message="Veuillez saisir votre message"></textarea>
                                <span class="input-validation"></span>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                            <button type="submit" class="btn btn-primary">Envoyer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script type="text/javascript" src="http://code.jquery.com/jquery.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/totop/jquery.easing.1.3.js"></script>
        <script type="text/javascript" src="js/totop/jquery.ui.totop.min.js"></script>
        <script type="text/javascript" src="js/jquery.emoticons.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
        <script type="text/javascript" src="js/snippet/jquery.snippet.min.js"></script>
        <script type="text/javascript" src="js/snippet/sh_sh.min.js"></script>
        <script type="text/javascript" src="js/snippet/sh_log.min.js"></script>
        <script type="text/javascript" src="js/snippet/snippet.js"></script>
        <script type="text/javascript" src="js/socialite.min.js"></script>
        <script type="text/javascript" src="js/share.js"></script>
    </body>
</html>